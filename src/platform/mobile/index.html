<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="format-detection" content="telephone=no">
  <title>Markdown Viewer</title>
  
  <!-- All styles bundled into one file -->
  <link rel="stylesheet" href="./styles.css">
  
  <style>
    /* Mobile-specific styles */
    :root {
      --safe-area-top: env(safe-area-inset-top, 0px);
      --safe-area-bottom: env(safe-area-inset-bottom, 0px);
      --safe-area-left: env(safe-area-inset-left, 0px);
      --safe-area-right: env(safe-area-inset-right, 0px);
    }
    
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    html {
      overflow-x: hidden;
    }
    
    body {
      padding: var(--safe-area-top) var(--safe-area-right) var(--safe-area-bottom) var(--safe-area-left);
      -webkit-overflow-scrolling: touch;
    }

    /* Offscreen render root (kept out of visible flow) */
    #render-root {
      position: fixed;
      left: -100000px;
      top: -100000px;
      width: 1px;
      height: 1px;
      overflow: hidden;
      visibility: hidden;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- Main content container -->
  <div id="markdown-content"></div>

  <!-- Render iframe: preloaded for faster diagram rendering -->
  <iframe id="render-frame" src="./render-frame.html" style="position: fixed; left: -10000px; top: -10000px; width: 1400px; height: 800px; border: none; visibility: hidden;"></iframe>
  
  <!-- Early message listener for render frame (must be before bundle.js) -->
  <script>
    // Global state for render frame communication
    window.__renderFrameReady = false;
    window.__renderFrameReadyCallbacks = [];
    window.__renderFramePendingRequests = new Map();
    
    // Listen for messages from render frame
    window.addEventListener('message', function(event) {
      var message = event.data;
      if (!message || typeof message !== 'object') return;
      
      // Handle ready signal from render frame
      if (message.type === 'RENDER_FRAME_READY') {
        if (!window.__renderFrameReady) {
          window.__renderFrameReady = true;
          
          // Send acknowledgment
          var iframe = document.getElementById('render-frame');
          if (iframe && iframe.contentWindow) {
            iframe.contentWindow.postMessage({ type: 'READY_ACK' }, '*');
          }
          
          // Notify any waiting callbacks
          window.__renderFrameReadyCallbacks.forEach(function(cb) { cb(); });
          window.__renderFrameReadyCallbacks = [];
        }
        return;
      }
      
      // Handle log messages from render frame (for debugging)
      if (message.type === 'RENDER_FRAME_LOG') {
        console.log.apply(console, ['[RenderFrame]'].concat(message.args || []));
        return;
      }
      
      // Handle responses to pending requests
      if (message.type === 'RESPONSE' && message.requestId !== undefined) {
        var pending = window.__renderFramePendingRequests.get(message.requestId);
        if (pending) {
          window.__renderFramePendingRequests.delete(message.requestId);
          if (message.error) {
            pending.reject(new Error(message.error));
          } else {
            pending.resolve(message.result);
          }
        }
      }
    });
  </script>
  
  <!-- Main bundle (generated by build script) -->
  <script src="./bundle.js"></script>
</body>
</html>
